RELEASE_TYPE: patch

Refactor some stateful testing internals for easier use by third-party libraries.
